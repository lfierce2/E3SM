#!/bin/bash

HOMME_ROOT=/home/celdred/E3SM/components/homme
NLEVELS=1
BASE_DIR=/home/celdred/E3SM/components/homme/swe_tests

mkdir -p laptop-cpu-new     || exit -1
cd laptop-cpu-new
rm -rf *


rm -rf CMakeFiles CMakeCache.txt
cmake                                                                          \
   -C /home/celdred/E3SM/components/homme/cmake/machineFiles/ubuntu1804.cmake  \
  -DDEBUG_FLAGS=" "                                                            \
  -DSWEQX_NP=4                                                                 \
  -DSWEQX_PLEV=$NLEVELS                                                        \
  -DBUILD_HOMME_SWEQX=TRUE                                                     \
  -DBUILD_HOMME_PREQX=FALSE                                                    \
  -DBUILD_HOMME_THETA=FALSE                                                    \
  -DBUILD_HOMME_PREQX_ACC=FALSE                                                \
  -DENABLE_OPENMP=TRUE                                                         \
  -DSWEQX_USE_PIO=TRUE                                                        \
  $HOMME_ROOT


make clean                                                  || exit -1

make -j4 sweqx                                              || exit -1
mkdir -p $BASE_DIR/execs
cp ./src/sweqx/sweqx $BASE_DIR/execs/sweqx-new.cpu      || exit -1
